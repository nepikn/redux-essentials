import type { AppStartListening } from "@/app/listenerMiddleware";
import { apiSlice } from "../api/apiSlice";

export interface Reactions {
  thumbsUp: number;
  tada: number;
  heart: number;
  rocket: number;
  eyes: number;
}

export type ReactionName = keyof Reactions;

export interface Post {
  id: string;
  title: string;
  content: string;
  user: string;
  date: string;
  reactions: Reactions;
}

export type PostUpdate = Pick<Post, "id" | "title" | "content">;
export type PostAdd = Pick<Post, "title" | "content" | "user">;

export const addPostsListeners = (
  startAppListening: AppStartListening,
) => {
  startAppListening({
    matcher: apiSlice.endpoints.addNewPost.matchFulfilled,
    effect: async (action, listenerApi) => {
      const { toast } = await import("react-tiny-toast");

      const toastId = toast.show("New post added!", {
        variant: "success",
        position: "bottom-right",
        pause: true,
      });

      await listenerApi.delay(5000);

      toast.remove(toastId);
    },
  });
};
